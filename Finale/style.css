const sendButton = document.getElementById("send-button");
const userInput = document.getElementById("user-input");
const chatBox = document.getElementById("chat-box");

const emotionalHistory = [];
const usedResponses = new Set();

const curseWords = ["damn", "hell", "shit", "fuck", "bitch", "crap", "ass"];
function censor(text) {
    return text.split(" ").map(word => {
        return curseWords.includes(word.toLowerCase()) ? "*".repeat(word.length) : word;
    }).join(" ");
}

const emotionResponses = {
    love: [
        "It sounds like you're feeling love. That can be a very meaningful emotion. Who or what are you feeling this love for, and what does it mean to you?",
        "Love often brings warmth and connection. How does this love make you feel, and what might it show you about what's important to you?",
        "Feeling love is an important experience. What do you notice about yourself when you feel this love, and why do you think it matters?"
    ],
    happy: [
        "I hear you're feeling happy. What do you think has contributed to this feeling?",
        "Feeling happy often highlights what's going well. What do you notice is contributing to your happiness right now?",
        "Happiness often comes from positive moments. Can you share what brought this happiness to you today?"
    ],
    excited: [
        "I sense you're feeling excited. What is happening or coming up that makes you feel this way?",
        "Excitement often comes when we're looking forward to something. Can you tell me what you're excited about?",
        "The excitement you feel, how does it show up for you? What do you notice about yourself when you're excited?"
    ],
    joy: [
        "Joy sounds like a profound feeling. What's bringing this joy into your life?",
        "Joy often indicates something deeply satisfying or meaningful. What do you think is contributing to this feeling of joy?",
        "When you're feeling joy, what do you notice about yourself or your surroundings that stands out?"
    ],
    gratitude: [
        "I see you're feeling gratitude. Who or what are you feeling thankful for, and why?",
        "Gratitude often highlights what's meaningful in our lives. What are you grateful for right now, and how does acknowledging it affect you?",
        "When you feel thankful, it often sheds light on the positives in your life. What is it that you're grateful for, and what does that feeling mean to you?"
    ],
    pride: [
        "It sounds like you're feeling proud. What accomplishment or quality in yourself are you feeling proud of?",
        "Pride often comes from recognizing our own strengths or achievements. What does this pride tell you about something you've done or become?",
        "Feeling proud can remind us of our growth. What are you proud of right now, and how did you achieve it?"
    ],
    relief: [
        "It seems you're feeling relieved. What was causing you stress before, and what changed to bring you this relief?",
        "Relief often feels like a calm after stress. Can you describe what was happening and what has eased it?",
        "This relief you're experiencing, how do you notice the change compared to before? What does it feel like now?"
    ],
    sad: [
        "That sounds really hard. What do you think triggered those feelings?",
        "I'm here to listen. When did you start feeling this way?",
        "Sometimes sharing how you feel can help a little. Would you like to talk more?"
    ],
    angry: [
        "Anger can be intense. Do you want to tell me what led up to this?",
        "It’s okay to feel angry. Let’s try to understand what’s behind it.",
        "Would you like to vent? I'm here for you."
    ],
    anxious: [
        "Anxiety can feel overwhelming. What’s been on your mind lately?",
        "Let’s slow things down. Can you describe what's making you anxious?",
        "One breath at a time. You're not alone here."
    ],
    stressed: [
        "Let’s take a deep breath together. What’s been weighing on you?",
        "When did you start feeling this stressed?",
        "It might help to break things down into smaller steps. Want to try?"
    ],
    scared: [
        "It’s okay to feel scared. You’re safe here with me.",
        "What happened that made you feel this way?",
        "You’re not alone. I’m listening."
    ],
    default: [
        "Tell me more about what’s been going on.",
        "I'm listening. What's been on your mind?",
        "Would you like to talk about it in more detail?"
    ]
};

function getEmotion(text) {
    const lower = text.toLowerCase();
    if (lower.includes("love")) return "love";
    if (lower.includes("joy")) return "joy";
    if (lower.includes("grateful") || lower.includes("gratitude")) return "gratitude";
    if (lower.includes("proud") || lower.includes("achievement")) return "pride";
    if (lower.includes("relief") || lower.includes("relieved")) return "relief";
    if (lower.includes("happy")) return "happy";
    if (lower.includes("excited") || lower.includes("thrilled")) return "excited";
    if (lower.includes("sad") || lower.includes("depressed") || lower.includes("lonely")) return "sad";
    if (lower.includes("angry") || lower.includes("mad") || lower.includes("furious")) return "angry";
    if (lower.includes("anxious") || lower.includes("nervous") || lower.includes("worried")) return "anxious";
    if (lower.includes("stressed") || lower.includes("tired") || lower.includes("overwhelmed")) return "stressed";
    if (lower.includes("scared") || lower.includes("afraid") || lower.includes("fear")) return "scared";
    return "default";
}

function getUniqueResponse(emotion) {
    const responses = emotionResponses[emotion] || emotionResponses["default"];
    for (let res of responses) {
        if (!usedResponses.has(res)) {
            usedResponses.add(res);
            return res;
        }
    }
    return responses[Math.floor(Math.random() * responses.length)];
}

function displayMessage(message, sender) {
    const messageDiv = document.createElement("div");
    messageDiv.classList.add(sender === "user" ? "user-message" : "bot-message");
    messageDiv.textContent = message;
    chatBox.appendChild(messageDiv);
    chatBox.scrollTop = chatBox.scrollHeight;
}

let hasGreeted = false;

sendButton.addEventListener("click", () => {
    let userText = userInput.value.trim();
    if (!userText) return;

    userText = censor(userText);
    displayMessage("You: " + userText, "user");

    let botResponse = "";

    // Normalize input for matching
    const lowerText = userText.toLowerCase();

    // Check for goodbye/thanks keywords first
    const goodbyeWords = ["bye", "goodbye", "thanks", "ty", "thank you"];
    if (goodbyeWords.some(word => lowerText.includes(word))) {
        botResponse = "You're welcome, pay it forward.";
        hasGreeted = false;  // Reset greeting for next conversation
        usedResponses.clear();  // Clear used responses for fresh start
    }
    // Check for greetings
    else if (["hi", "hello", "hey", "hiya", "greetings"].some(greet => lowerText === greet || lowerText.startsWith(greet + " "))) {
        if (!hasGreeted) {
            botResponse = "Hi there. What’s been going on lately?";
            hasGreeted = true;
        } else {
            // If already greeted, respond with something warm but not repetitive
            botResponse = "Welcome back! How are you feeling today?";
        }
    }
    else {
        const emotion = getEmotion(userText);
        emotionalHistory.push(emotion);
        botResponse = getUniqueResponse(emotion);
    }

    setTimeout(() => {
        displayMessage("Bot: " + botResponse, "bot");
    }, 600);

    userInput.value = "";
});

userInput.addEventListener("keypress", function(event) {
    if (event.key === "Enter") {
        sendButton.click();
    }
});
